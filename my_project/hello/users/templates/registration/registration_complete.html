{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-success text-white">
            <h2><i class="fas fa-check-circle"></i> Registrierung erfolgreich!</h2>
        </div>
        <div class="card-body">
            <div class="alert alert-info">
                <h4>Was passiert jetzt?</h4>
                <ol>
                    <li>Wir haben eine Bestätigungs-E-Mail an <strong>{{ request.session.registered_email }}</strong> gesendet</li>
                    <li>Bitte überprüfen Sie Ihren Posteingang</li>
                    <li>Klicken Sie auf den Aktivierungslink in der E-Mail</li>
                </ol>
                
                <div class="mt-3 p-3 bg-light rounded">
                    <h5><i class="fas fa-question-circle"></i> Keine E-Mail erhalten?</h5>
                    <ul>
                        <li>Überprüfen Sie Ihren Spam-Ordner</li>
                        <li>Warten Sie 5-10 Minuten</li>
                        <li>
                            <form action="{% url 'users:resend_activation' %}" method="post" id="resend-form" class="d-inline">
                                {% csrf_token %}
                                <input type="hidden" name="email" value="{{ request.session.registered_email }}">
                                <button type="submit" class="btn btn-link p-0 text-primary">
                                    <i class="fas fa-redo"></i> Link erneut senden
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>

            {% if messages %}
                <div class="mt-3">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
            
            <a href="{% url 'login' %}" class="btn btn-primary mt-3">
                <i class="fas fa-home"></i> Zum Login
            </a>
        </div>
    </div>
</div>

<script>
document.getElementById('resend-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = this;
    const submitBtn = form.querySelector('button[type="submit"]');
    
    // Deaktivieren Sie den Button während der Anfrage
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird gesendet...';
    
    fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        }
    })
    .then(response => {
        if (response.ok) {
            // Erfolgsmeldung anzeigen
            const messagesDiv = document.createElement('div');
            messagesDiv.className = 'alert alert-success mt-3';
            messagesDiv.innerHTML = 'Aktivierungslink wurde erfolgreich erneut gesendet!';
            form.parentNode.insertBefore(messagesDiv, form.nextSibling);
            
            // Nach 5 Sekenden ausblenden
            setTimeout(() => {
                messagesDiv.remove();
            }, 5000);
        } else {
            alert('Fehler beim Senden des Links');
        }
    })
    .catch(error => {
        alert('Netzwerkfehler: ' + error);
    })
    .finally(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-redo"></i> Link erneut senden';
    });
});
</script>
{% endblock %}